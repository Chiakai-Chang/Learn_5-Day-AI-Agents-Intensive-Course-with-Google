```markdown
### 🎙️ 第 13 頁：MCP Tool Results: Content Types and Error Handling

#### 【本頁重點摘要】
*   MCP 工具的回傳結果可分為「非結構化內容」與「結構化內容」兩大類。
*   非結構化內容包含文字、音訊、圖片，以及指向外部資源的連結。
*   結構化內容是 JSON 物件，應搭配 `outputSchema` 進行驗證。
*   MCP 定義了兩種錯誤處理機制：處理通訊協定問題的「協定錯誤」，以及處理工具內部失敗的「工具執行錯誤」。

---

#### 【逐字講稿】

(開場白)
好的，我們剛剛定義了一個 MCP 工具的樣貌，但工具執行完畢後，它會回傳什麼東西給我們呢？這一頁，我們就來深入探討工具回傳的「結果格式」以及非常重要的「錯誤處理」機制。

##### ① 結果的內容格式 (Content Types)
首先，MCP 工具的回傳結果非常有彈性，主要分為兩大類。

第一種是 **非結構化內容 (Unstructured Content)**。
*   最基本的就是 `Text`，也就是純文字字串。
*   它也可以回傳 `Audio` 或 `Image`，這些資料會經過 Base64 編碼，並附上對應的 MIME 類型，讓客戶端知道如何解讀。
*   還有一種比較特別的，叫做 `Resource`。它可以是一個指向外部大型資源（例如某個檔案或資料庫紀錄）的連結，也可以是直接將該資源嵌入在結果中。不過這裡要特別小心，直接使用來自不受信任伺服器的資源，可能會帶來安全風險。

第二種則是 **結構化內容 (Structured Content)**。
> 這種類型的內容，一律是以 JSON 物件的形式回傳。

強烈建議工具的開發者，一定要在工具定義中提供 `outputSchema`。這不僅能讓客戶端用它來驗證回傳的 JSON 是否符合格式，更重要的是，它也像一份說明書，能幫助 LLM 理解這個工具會回傳什麼、以及如何使用這些回傳的資料。

##### ② 兩種標準錯誤處理機制
當然，工具的呼叫不可能永遠一帆風順。當出現問題時，MCP 也定義了兩種標準的錯誤回報機制。

第一種是 **協定錯誤 (Protocol Errors)**。
*   這是指在 JSON-RPC 通訊層級發生的問題。例如，你呼叫了一個根本不存在的工具，或是傳遞了錯誤的參數。
*   在這種情況下，伺服器會回傳一個標準的 JSON-RPC 錯誤物件，裡面會包含錯誤代碼（`code`）和錯誤訊息（`message`），清楚地告訴你問題出在哪裡。

第二種是 **工具執行錯誤 (Tool Execution Errors)**。
*   這指的是工具本身在執行過程中發生了失敗。例如，工具要去呼叫一個後端 API，但那個 API 剛好掛了，或是商業邏輯上出現了錯誤。
*   在這種情況下，伺服器會回傳一個看起來正常的 `result` 物件，**但它會在物件中加上一個 `"isError": true` 的參數來標示這是一個錯誤**。
*   這是一個非常重要的設計！因為這個錯誤訊息通道，其實是我們引導 LLM 如何從失敗中恢復的絕佳機會。一個好的錯誤訊息不應該只說「失敗了」，而應該像個教練一樣，告訴 LLM：「API 速率超過限制了，請等待 15 秒後再試一次。」

---

#### 【講者提示 & 轉場】
*   **節奏提醒**：在講到「工具執行錯誤」時，可以稍微加重語氣，強調 `isError: true` 這個技術細節，並說明它如何成為引導 AI 的機會。
*   **補充案例**：可以展示 `Snippets 7` 和 `Snippets 8` 的 JSON 範例，讓聽眾更具體地了解兩種錯誤訊息的格式差異。
*   **轉場橋樑 (Bridge)**：
    > 了解了工具如何回傳結果與處理錯誤後，我們已經掌握了 MCP 最核心的 `Tool` 功能。不過，MCP 的野心不止於此。下一頁，我們將看看 MCP 定義的其他幾項能力，雖然它們目前還不普及，但卻揭示了 MCP 對未來更複雜互動的想像，同時也伴隨著更高的風險。

```